{% extends 'base.html' %}

{% block upper_left %}
    <div class="nav-container">
        <a class="upper-left" href="{{ url_for('overview') }}">Overview</a>
        <span class="separator">|</span>
        <a class="upper-left" href="{{ url_for('configure') }}">General Setup</a>
        <span class="separator">|</span>
        <a class="upper-left" href="{{ url_for('configure_location', loc_id=current.id) }}">Location Setup</a>
    </div>
{% endblock %}

{% block content %}
    <h1>{{ current.name }}</h1>
    {% if current.description %}
        <p>{{ current.description }}</p>
    {% endif %}

    {% set outerscope = namespace(display_section = false) %}
    {% for char in game_data.characters %}
        {% if char.location.id == current.id %}
            {% set outerscope.display_section = true %}
        {% endif %}
    {% endfor %}
    {% if outerscope.display_section %}
    <h2>Characters</h2>
    <ul>
        {% for char in game_data.characters if char.location.id == current.id %}
            <li>
                <a href="{{ url_for('play_char', char_id=char.id) }}">{{ char.name }}</a>
            </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if current.items %}
        <h2>Items</h2>
        <ul class="item-list">
            {% for item_at in current.items %}
                {% set item = item_at.item %}
                <li>
                    <span class="item-name">
                        <a href="{{ url_for('play_item', item_id=item.id, loc_id=current.id) }}">
                            {{ item.name }}
                        </a>
                    </span>
                    <span class="item-quantity" id="item-{{ item.id }}-quantity">
                        {% if not (item_at.item.q_limit == 1 and item_at.quantity == 1) %}
                            {{ item_at.quantity | dec2str }}
                        {% endif %}
                    </span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No items at this location.</p>
    {% endif %}

    {% if current.destinations %}
    <h2>Destinations</h2>
    <ul>
        {% for destination, distance in current.destinations.items() %}
            <li>
                <a href="{{ url_for('play_location', loc_id=destination.id) }}">{{ destination.name }}</a> â€”
                Distance {{ distance | dec2str }}
            </li>
        {% endfor %}
    </ul>
    {% endif %}

    <script>
        $(document).ready(function() {
            function updateQuantities() {
                {% for item_at in current.items %}
                    // Make AJAX request for item quantity
                    $.get('/item/progress_data/{{ item_at.item.id }}', function(data) {
                        $('#item-{{ item_at.item.id }}-quantity').text(data.quantity);
                    });
                {% endfor %}
            }

            // Update quantities initially
            //updateQuantities();

            // Update quantities periodically
            //setInterval(updateQuantities, 10000);
        });
    </script>
{% endblock %}
